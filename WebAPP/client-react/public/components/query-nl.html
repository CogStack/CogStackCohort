<!-- ===== Latest (Natural Language) ===== -->
<div x-show="!isV1" x-cloak class="container px-6 max-w-screen-2xl mx-auto rounded-xl">

  <header class="z-10 py-4 bg-white dark:bg-gray-900 rounded-xl">
  <div class="mx-auto w-full ">
    <div class="relative w-full rounded-xl bg-white dark:bg-gray-900">
      <div class="px-4 pt-3 pb-12">
        <!--
        <label for="nl_query_text" class="block text-sm font-medium text-gray-700 dark:text-gray-200 mb-2">
          Natural language query
        </label>
        -->

        <!--<textarea
          id="nl_query_text"
          x-ref="nlBox"
          x-model="nl_query_text"
          rows="5"
          class="block w-full rounded-xl bg-transparent text-sm text-gray-900 dark:text-gray-100
                 placeholder-gray-400 dark:placeholder-gray-500 resize-y outline-none"
          placeholder='e.g., "Man aged 18 or above with DM-II and then HF within 1 year"'
          aria-label="Natural language query"
          @keydown="if (is_busy || nl_loading) return; if ($event.key === 'Enter' && !$event.shiftKey) { $event.preventDefault(); handle_nl_run(); }"
        ></textarea>-->


        <textarea
          id="nl_query_text"
          x-ref="nlBox"
          x-model="nl_query_text"
          rows="5"
          class="block w-full rounded-xl ..."
          placeholder='e.g., "Man aged 18 or above with DM-II and then HF within 5 years"'
          aria-label="Natural language query"
          @input="stop_typing()"
          @keydown="if (is_busy || nl_loading) return; if ($event.key === 'Enter' && !$event.shiftKey) { $event.preventDefault(); handle_nl_run(); }"
        ></textarea>


        <p class="mt-2 text-xs text-gray-500 dark:text-gray-400">
          Press <kbd class="px-1 py-0.5 bg-gray-200 dark:bg-gray-900 rounded">Enter</kbd> to run ·
          <kbd class="px-1 py-0.5 bg-gray-200 dark:bg-gray-900 rounded">Shift</kbd>+<kbd class="px-1 py-0.5 bg-gray-200 dark:bg-gray-900 rounded">Enter</kbd> for a new line
        </p>
      </div>

      <!-- Examples -->
<div class="absolute left-3 bottom-3 flex flex-wrap gap-2 text-xs">
  <a href="#"
     class="px-2.5 py-1 rounded-md border border-gray-300 text-gray-700
            dark:border-gray-600 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700"
     @click.prevent="type_text_to_nl('Man aged 18 or above with DM-II and then HF within 5 years'); $nextTick(() => $refs.nlBox?.focus())">
    Example 1
  </a>

  <a href="#"
     class="px-2.5 py-1 rounded-md border border-gray-300 text-gray-700
            dark:border-gray-600 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700"
     @click.prevent="type_text_to_nl('Adult with aortic stenosis followed by heart failure within 365 days'); $nextTick(() => $refs.nlBox?.focus())">
    Example 2
  </a>

  <a href="#"
     class="px-2.5 py-1 rounded-md border border-gray-300 text-gray-700
            dark:border-gray-600 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700"
     @click.prevent="type_text_to_nl('Female under 40 with iron deficiency anemia'); $nextTick(() => $refs.nlBox?.focus())">
    Example 3
  </a>

  <a href="#"
     class="px-2.5 py-1 rounded-md border border-gray-300 text-gray-700
            dark:border-gray-600 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700"
     @click.prevent="type_text_to_nl('Patients with asthma and diabetes or COPD'); $nextTick(() => $refs.nlBox?.focus())">
    Example 4
  </a>
<a href="#"
   class="px-2.5 py-1 rounded-md border border-gray-300 text-gray-700
          dark:border-gray-600 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700"
   @click.prevent="type_text_to_nl('Female aged 65 or above with hip fracture'); $nextTick(() => $refs.nlBox?.focus())">
  Example 5
</a>
</div>

      <div class="absolute right-3 bottom-3 items-center gap-2">
        <button
    type="button"
    class="inline-flex items-center gap-2 px-4 mx-5 py-2 rounded-lg border border-gray-300 text-gray-700
           dark:border-gray-600 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700"
    @click="clear_nl"
  >
    Clear
  </button>
        <!--<button class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-purple-600 text-white hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500" @click="handle_nl_run">
          <svg class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path d="M6 4.5l9 5.5-9 5.5V4.5z"/></svg>
          Run
        </button>-->
        <button
          class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-purple-600 text-white
                hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500
                disabled:opacity-50 disabled:cursor-not-allowed"
          @click="handle_nl_run"
          :disabled="is_busy || nl_loading"
          :aria-busy="(is_busy || nl_loading) ? 'true' : 'false'"
          :aria-disabled="(is_busy || nl_loading) ? 'true' : 'false'"
        >
          <svg class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
            <path d="M6 4.5l9 5.5-9 5.5V4.5z"/>
          </svg>
          Run
        </button>




      </div>
    </div>
  </div>

  <!-- Reasoning (streams word-by-word) -->
  <!--
  <div x-show="reasoning_stream || reasoning_full"
      class="mt-3 rounded-md p-3 text-sm text-gray-700 dark:text-gray-200"
      aria-live="polite">
    <div class="mb-1 font-medium text-gray-600 dark:text-gray-300">Model reasoning</div>
    <p class="whitespace-pre-wrap leading-relaxed" x-text="reasoning_stream"></p>
  </div>
  -->
  <!-- Reasoning (editable) -->
  <div x-show="reasoning_stream || reasoning_full || nl_reasoning_editing"
     class="mt-3 rounded-md p-3 text-sm text-gray-700 dark:text-gray-200 border dark:border-gray-700"
     aria-live="polite">

  <div class="mb-2 flex items-center justify-between">
    <div class="font-medium text-gray-600 dark:text-gray-300">Model reasoning</div>

    <!-- Right-side actions -->
    <div class="space-x-2">
      <!-- Readonly state actions -->
      <button x-show="!nl_reasoning_editing"
              class="px-2 py-1 rounded border dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700"
              @click="start_edit_reasoning">
        Edit
      </button>
      <button x-show="!nl_reasoning_editing"
              class="px-2 py-1 rounded border dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700"
              @click="nl_query_text = reasoning_full || nl_reasoning; $nextTick(()=> $refs.nlBox?.focus())">
        Use as query
      </button>

      <!-- Edit state actions -->
      <button x-show="nl_reasoning_editing"
              class="px-2 py-1 rounded bg-purple-600 text-white hover:bg-purple-700"
              @click="apply_edited_reasoning">
        Apply
      </button>
      <button x-show="nl_reasoning_editing"
              class="px-2 py-1 rounded border dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700"
              @click="cancel_edit_reasoning">
        Cancel
      </button>
    </div>
  </div>

  <!-- Readonly view (streamed) -->
  <p x-show="!nl_reasoning_editing"
     class="whitespace-pre-wrap leading-relaxed"
     x-text="reasoning_stream"></p>

  <!-- Edit view -->
  <textarea x-show="nl_reasoning_editing"
            x-model="nl_reasoning_edit_text"
            rows="6"
            class="w-full mt-1 rounded bg-transparent border border-gray-300 dark:border-gray-700 p-2 text-sm
                   text-gray-900 dark:text-gray-100"
            placeholder="Edit the reasoning here…"></textarea>

  <div x-show="nl_reasoning_editing" class="mt-1 text-xs text-gray-500">
    Shift+Enter for a new line.
  </div>
  </div>

  <!--<div class="text-gray-500" x-text="running_status"></div>-->
  <!--<div class="flex items-center text-gray-600 ml-6">
  <span x-text="running_status"></span>
  <span x-show="is_busy" x-cloak
        class="ml-2 inline-block h-4 w-4 border-2 border-current border-t-transparent rounded-full animate-spin"
        aria-label="Loading"></span>
  </div>-->
  <coh-status-inline></coh-status-inline>


  </header>
</div>
